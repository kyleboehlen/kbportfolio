packages:
  yum:
    amazon-cloudwatch-agent: []

files:
    "/etc/awslogs/awscli.conf" :
        mode: "000600"
        owner: root
        group: root
        content: |
          [plugins]
          cwlogs = cwlogs
          [default]
          region = `{"Ref":"AWS::Region"}`
    "/opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.d/file_config.json":
        mode: "000600"
        owner: root
        group: root
        content: |
        {
            "logs": {
                "logs_collected": {
                    "files": {
                        "collect_list": {
                            [
                                "file_path": "/var/app/current/storage/logs/laravel.log",
                                "log_group_name": "/aws/elasticbeanstalk/kbportfolio-prod-2024/var/log/laravel.log",
                                "log_stream_name": "{instance_id}"
                            ]
                        }
                    }
                }
            }
        }

container_commands:
    test_command_01:
        command: "echo '01 is this thing on?'"
    load_config:
        command: "/opt/aws/amazon-cloudwatch-agent/bin/amazon-cloudwatch-agent-ctl -a append-config -m ec2 -s -c file:/opt/aws/amazon-cloudwatch-agent/etc/amazon-cloudwatch-agent.d/file_config.json"
    enable_service:
        command: "sudo systemctl enable amazon-cloudwatch-agent.service"
    restart_agent:
        command: "sudo systemctl restart amazon-cloudwatch-agent"
    test_command_02:
        command: "echo '02 is this thing on?'"
